<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.giftednote.user.note.service.impl.UserNoteMapper">
	<select id="getList" resultType="hashMap" parameterType="egovframework.giftednote.user.note.model.UserNoteVo">
		SELECT * 
		FROM TBL_NOTE N JOIN TBL_TEAM T
		WHERE N.N_IDX = T.N_IDX 
			AND 1=1 	     	
		<if test="EMAIL != ''">
	    	AND T.EMAIL = #{EMAIL}
	    </if>
	</select>
	
	<select id="getListCnt" resultType="int" parameterType="egovframework.giftednote.user.note.model.UserNoteVo">
		SELECT count(*) 
		FROM TBL_NOTE N JOIN TBL_TEAM T
		WHERE N.N_IDX = T.N_IDX 
		AND 1=1
		<if test="EMAIL != ''">
	    	AND T.EMAIL = #{EMAIL}
	    </if>
	</select>
	
	<insert id="setNote" parameterType="egovframework.giftednote.user.note.model.UserNoteVo" useGeneratedKeys="true" keyProperty="N_IDX">
		INSERT INTO TBL_NOTE 
		(IDX , IMAGE , TITLE , TOPIC , LEADER , ASSI , INTRO) 
		VALUES 
		(#{IDX} , #{IMAGE} , #{TITLE} , #{TOPIC} , #{LEADER} , #{ASSI} , #{INTRO})
	</insert>
	
	<insert id="setTeam" parameterType="egovframework.giftednote.user.team.model.UserTeamVo">
		INSERT INTO TBL_TEAM
		(N_IDX , IDX , NAME , SCHOOL_YEAR , SCHOOL_NAME , LEVEL , EMAIL) 
		VALUES 
		(#{N_IDX} , #{IDX} , #{NAME} , #{SCHOOL_YEAR} , #{SCHOOL_NAME} , #{LEVEL} , #{EMAIL})
	</insert>
	
	<select id="getDetail" resultType="hashMap" parameterType="egovframework.giftednote.user.note_detail.model.UserNoteDetailVo">
		SELECT *
		FROM TBL_NOTE_DETAIL 
		WHERE N_IDX = #{N_IDX}
		<if test="P_IDX != ''">
	    	AND P_IDX = #{P_IDX}
	    </if>
	    <if test="P_IDX == ''">
	    	AND P_IDX = '1'
	    </if>
	</select>
	
	<select id="getDetailCnt" resultType="int" parameterType="egovframework.giftednote.user.note_detail.model.UserNoteDetailVo">
		SELECT count(*)
		FROM TBL_NOTE_DETAIL 
		WHERE N_IDX = #{N_IDX}
	</select>
	
</mapper>